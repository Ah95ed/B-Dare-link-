# ุชุญุฏูุซ ุงูุฅุตูุงุญุงุช ูุงูููุฒุงุช ุงูุฌุฏูุฏุฉ - Wonder Link Game

## ููุฎุต ุงูุชุญุฏูุซ

ุชู ุชุญุณูู ุฌูุฏุฉ ุงูุฃุณุฆูุฉ ูุฅุถุงูุฉ ูุธุงู ูุชูุฏู ููุฅุนุฏุงุฏุงุช ูุงููุณุงุนุฏุงุช ูุงูุฅุจูุงุบ ุนู ุงูุฃุณุฆูุฉ ุงูุณูุฆุฉ.

---

## 1๏ธโฃ ุชุญุณููุงุช ุฌูุฏุฉ ุงูุฃุณุฆูุฉ

### ุงููุดููุฉ ุงูุฃุตููุฉ
- ุฎูุท ุงูุฃุญุฑู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- ุฃุฎุทุงุก ุฅููุงุฆูุฉ ูู ุงููุตูุต ุงูุนุฑุจูุฉ
- ุฎูุงุฑุงุช ุบูุฑ ููุทููุฉ ุฃู ูุชูุงูุถุฉ
- ุฃุณุฆูุฉ ุบูุฑ ูุงุถุญุฉ

### ุงูุญู ุงููุทุจู

#### ุฃ) ุชุญุณูู ุงูู Prompts
**ููู**: `backend/src/prompt.js`

- **ุชุนูููุงุช ุฃูุณู ูุฃูุถุญ** ูู Gemini:
  ```javascript
  // ูุซุงู: ููุน ุฎูุท ุงููุบุงุช ุจุดูู ุญุงุณู
  "ุฃู ุฎูุท ุจุงูุฅูุฌููุฒูุฉ = ุฑูุถ ุตุฑูุญ โ"
  "ุฃู ุฃุฎุทุงุก ุฅููุงุฆูุฉ = ุฑูุถ ุตุฑูุญ โ"
  ```

- **ุชูููู Temperature ูู 0.9 ุฅูู 0.7**
  - ูุฌุนู ุงูุงุณุชุฌุงุจุงุช ุฃูุซุฑ ุงุชุณูุงูุงู ูุงูุถุจุงุทุงู

- **ุชุนูููุงุช ุจุตูุบุฉ Requirements ุตุงุฑูุฉ**:
  ```javascript
  Hard Requirements (must follow):
  - No language mixing
  - Proper spelling and grammar
  - All 4 options must be distinct
  - Question must be clear
  - Exactly one correct answer
  ```

#### ุจ) ูุธุงู Validation ููู
**ููู**: `backend/src/puzzle_validator.js` (ุฌุฏูุฏ)

ูุชุญูู ูู:
- โ ุตุญุฉ JSON
- โ ุนุฏู ุฎูุท ุงููุบุงุช
- โ ุนุฏู ุงูุชูุฑุงุฑ ุจูู ุงูุฎูุงุฑุงุช
- โ ุตุญุฉ ุงููุญุชูู ุงูุนุฑุจู (ุชุงุก ูุฑุจูุทุฉุ ููุฒุงุชุ ุฅูุฎ)
- โ ุชููุน ุทูู ุงูุฎูุงุฑุงุช
- โ ุตุญุฉ ูุคุดุฑ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ

```javascript
// ุงุณุชุฎุฏุงู ูู generateAIPuzzle
const validation = validator.validatePuzzle(parsed, language);
if (!validation.valid) {
  throw new Error(`Puzzle validation failed: ${validation.errors.join('; ')}`);
}
```

#### ุฌ) Fallback ูุงูุชูุตูุญ
**ููู**: `backend/src/competitions.js`

```javascript
// ุฌูุฏุฉ ููุฎูุถุฉ < 70% = ุชุญุฐูุฑ ููู ูุชู ุงุณุชุฎุฏุงู
if (quality < 70) {
  console.warn('[AI PUZZLE LOW QUALITY]', {
    qualityScore: quality,
    warnings: validation.warnings,
  });
}

// Sanitize ูู ุณุคุงู
const sanitized = validator.sanitizePuzzle(parsed);
```

---

## 2๏ธโฃ ูุธุงู ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ

### ุงูููุฒุฉ
ุงูุณูุงุญ ููุฏูุฑ ุงูุบุฑูุฉ ุจุชุฎุตูุต ุงููุนุจุฉ ุญุณุจ ุงุญุชูุงุฌุงุช ุงููุฑูู.

### ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ููู**: `backend/schema.sql`

```sql
CREATE TABLE room_settings (
  hints_enabled BOOLEAN DEFAULT TRUE,
  hints_per_player INTEGER DEFAULT 3,
  hint_penalty_percent REAL DEFAULT 10,
  allow_report_bad_puzzle BOOLEAN DEFAULT TRUE,
  auto_advance_seconds INTEGER DEFAULT 2,
  shuffle_options BOOLEAN DEFAULT TRUE,
  show_rankings_live BOOLEAN DEFAULT TRUE,
  allow_skip_puzzle BOOLEAN DEFAULT FALSE,
  min_time_per_puzzle INTEGER DEFAULT 5,
);
```

### ูุงุฌูุฉ ุงููุณุชุฎุฏู
**ููู**: `lib/views/competitions/room_settings_view.dart` (ุฌุฏูุฏ)

**ูููุฏูุฑ**:
- ุชุญุฑูุฑ ุฌููุน ุงูุฅุนุฏุงุฏุงุช
- ุชูุนูู/ุชุนุทูู ุงููุณุงุนุฏุงุช
- ุชุนุฏูู ุนุฏุฏ ุงููุณุงุนุฏุงุช ูุงูุนููุจุงุช
- ุงูุชุญูู ุจุณุฑุนุฉ ุงูุงูุชูุงู
- ุชูุนูู/ุชุนุทูู ุงูุฅุจูุงุบ ุนู ุงูุฃุณุฆูุฉ

**ููุฃุนุถุงุก**:
- ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช (ูุฑุงุกุฉ ููุท)
- ุฑุคูุฉ ุฅุนุฏุงุฏุงุช ุงููุนุจุฉ

### API Endpoints
**ููู**: `backend/src/settings.js` (ุฌุฏูุฏ)

```javascript
GET  /rooms/settings?roomId=ID     // ุงูุญุตูู ุนูู ุงูุฅุนุฏุงุฏุงุช
POST /rooms/settings               // ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช (ูุฏูุฑ ููุท)
```

---

## 3๏ธโฃ ูุธุงู ุงููุณุงุนุฏุงุช (Hints)

### ุงูููุฒุฉ
ููุญ ูู ูุงุนุจ ุนุฏุฏ ูุญุฏูุฏ ูู ุงููุณุงุนุฏุงุช ููู ุฌููุฉ.

### ุขููุฉ ุงูุนูู

1. **ูู ูุงุนุจ ูุญุตู ุนูู N ูุณุงุนุฏุงุช** (ูุงุจูุฉ ููุชุฎุตูุตุ ุงูุชุฑุงุถู = 3)

2. **ุนูุฏ ุทูุจ ูุณุงุนุฏุฉ**:
   - ุนุฑุถ ุงูู hint ููุณุคุงู ุงูุญุงูู
   - ุฎุตู ูุณุงุนุฏุฉ ูู ุงูุนุฏุฏ ุงููุชุจูู
   - ุชูููู ููุงุท ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุจู 10% (ูุงุจู ููุชุนุฏูู)

3. **UI ุงูุฌุฏูุฏ**:
```dart
// ูู room_game_view.dart
ElevatedButton.icon(
  onPressed: () => _getHint(context, _provider),
  icon: const Icon(Icons.lightbulb),
  label: const Text('ุงุญุตู ุนูู ูุณุงุนุฏุฉ'),
)
```

### API Endpoints

```javascript
POST /rooms/hint {
  roomId: int,
  puzzleIndex: int
}

Response:
{
  hint: "ุชูููุญ ุงููุณุงุนุฏุฉ",
  hintsRemaining: 2
}
```

### ุชุฎุฒูู ุงูุญุงูุฉ
```sql
CREATE TABLE room_participants (
  hints_used INTEGER DEFAULT 0,
  hints_available INTEGER DEFAULT 3,
);
```

---

## 4๏ธโฃ ูุธุงู ุงูุฅุจูุงุบ ุนู ุงูุฃุณุฆูุฉ ุงูุณูุฆุฉ

### ุงููุดููุฉ ุงููุญูููุฉ
ุงููุณุชุฎุฏููู ูููููู ุงูุฅุจูุงุบ ุนู ุงูุฃุณุฆูุฉ ุฐุงุช ุงููุดุงูู ุจุฏูุงู ูู ุงูุงุณุชูุฑุงุฑ ุจุณููุช.

### ุฃููุงุน ุงูุชูุงุฑูุฑ

```javascript
const reportTypes = [
  'bad_wording',    // ุฎุทุฃ ูู ุงูุตูุงุบุฉ
  'wrong_answer',   // ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุฎุงุทุฆุฉ
  'unclear',        // ุงูุณุคุงู ุบูุฑ ูุงุถุญ
  'offensive',      // ูุญุชูู ูุณูุก
  'duplicate',      // ุณุคุงู ููุฑุฑ
  'other'          // ุฃุฎุฑู
];
```

### ูุงุฌูุฉ ุงููุณุชุฎุฏู

```dart
// ูู room_game_view.dart
ElevatedButton.icon(
  onPressed: () => _reportBadQuestion(context, _provider),
  icon: const Icon(Icons.flag),
  label: const Text('ุณุคุงู ุบูุฑ ูุงุถุญ'),
)
```

ููุชุญ dialog ูุญุชูู ุนูู:
- ุงุฎุชูุงุฑ ููุน ุงููุดููุฉ
- ุญูู ุงุฎุชูุงุฑู ูุฅุถุงูุฉ ุชูุงุตูู
- ุฒุฑ ุงูุฅุฑุณุงู

### ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
CREATE TABLE puzzle_reports (
  room_id INTEGER NOT NULL,
  puzzle_index INTEGER NOT NULL,
  puzzle_json TEXT,        -- ุญูุธ ุงูุณุคุงู ูููุฑุฌุนูุฉ
  user_id INTEGER NOT NULL,
  report_type TEXT NOT NULL,
  details TEXT,
  reported_at TIMESTAMP,
);
```

### API Endpoints

```javascript
POST /rooms/report {
  roomId: int,
  puzzleIndex: int,
  reportType: string,  // ูู ุงููุงุฆูุฉ ุฃุนูุงู
  details: string      // ุงุฎุชูุงุฑู
}

GET /rooms/reports?roomId=ID  // ูููุฏูุฑ ููุท
```

---

## 5๏ธโฃ ุชูุตูุงุช ููุงุณุชุฎุฏุงู ุงูุฃูุซู

### ูููุฏุฑุงุก
1. **ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช ูุจู ุงูุจุฏุก**:
   - ุญุณูู ุนุฏุฏ ุงููุณุงุนุฏุงุช ุญุณุจ ุตุนูุจุฉ ุงูุฃุณุฆูุฉ
   - ุงุถุจุท ููุช ุงูุงูุชูุงู ุงูุชููุงุฆู

2. **ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ**:
   - ุงุญูุธ ุงูุชูุงุฑูุฑ ูุชุญุณูู ุงูุฃุณุฆูุฉ ูุงุญูุงู
   - ุงุณุชุฎุฏููุง ูู ููุงุญุธุงุชู

### ููุงุนุจูู
1. **ุงุณุชุฎุฏุงู ุงููุณุงุนุฏุงุช ุจุญููุฉ**:
   - ุงุญูุธ ุงููุณุงุนุฏุงุช ููุฃุณุฆูุฉ ุงูุตุนุจุฉ
   - ุชุฐูุฑ: ุงุณุชุฎุฏุงู ูุณุงุนุฏุฉ = ุฎุณุงุฑุฉ 10% ูู ุงูููุงุท

2. **ุงูุฅุจูุงุบ ุนู ุงููุดุงูู**:
   - ุฃุจูุบ ุนู ุฃู ุณุคุงู ุบูุฑ ูุงุถุญ ููุฑุงู
   - ุณุงุนุฏ ูู ุชุญุณูู ุงููุนุจุฉ ููุฌููุน

---

## 6๏ธโฃ ููุงุท ุชูููุฉ ูููุฉ

### ุฃูุงู ูุตูุงุญูุงุช

```javascript
// ููุท ูุฏูุฑ ุงูุบุฑูุฉ ููููู ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช
if (room.created_by !== user.id) {
  return errorResponse('Only room creator can modify settings', 403);
}

// ููุท ุงููุดุงุฑููู ูููููู ุงูุฅุจูุงุบ ุนู ุงูุฃุณุฆูุฉ
if (!participantExists) {
  return errorResponse('You are not in this room', 403);
}
```

### ุฃุฏุงุก

- **Validation ููุงุฒู**: ูุชู ุงูุชุญูู ูู ุงูุฃุณุฆูุฉ ูุจู ุญูุธูุง
- **Caching**: ุงูุฅุนุฏุงุฏุงุช ุชูุฎุฒูู ูู room_settings
- **Indexes**: ููุงุฑุณ ุณุฑูุนุฉ ุนูู `room_id` ู `user_id`

### ุงูุชูุงูููุฉ

- ุชุฏุนู ุฃุณุฆูุฉ ุงูุฃุฑุซูุฐููุณ (Question/Options) ูุงูุฃุณุฆูุฉ ุงูููุฑูุซุฉ (Steps)
- ูุชูุงููุฉ ูุน ุฌููุน ูุบุงุช ุงููุฏุนููุฉ (ar, en)

---

## 7๏ธโฃ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุตู ุจูุง

### ูุณุชูุจูู (ุฅุถุงูู)

1. **ูุธุงู ุชูููู ุงูุฃุณุฆูุฉ ุงูุฐูู**:
   - ุชุชุจุน ุนุฏุฏ ุงูุฅุจูุงุบุงุช ููู ุณุคุงู
   - ุฅุฎูุงุก ุงูุฃุณุฆูุฉ ุฐุงุช ุงูุฅุจูุงุบุงุช ุงููุซูุฑุฉ

2. **ุชุญุณูู AI ุฌูุงุนู**:
   - ุงุณุชุฎุฏุงู ุฑุฏูุฏ ุงููุงุนุจูู ูุชุฏุฑูุจ ูููุฐุฌ ุฃูุถู
   - ุชุญุฏูุซ ุงูุฃุณุฆูุฉ ุงูุถุนููุฉ ุชููุงุฆูุงู

3. **ูุธุงู ุชุตููุฉ ุงูุฃุณุฆูุฉ**:
   - ุญูุธ ุงูุฃุณุฆูุฉ ุงูุฌูุฏุฉ ูู ููุชุจุฉ
   - ุงุณุชุฎุฏุงู mix ูู AI ูุงูุฃุณุฆูุฉ ุงููุญููุธุฉ

---

## ๐ ููุฎุต ุงูุชุญุณููุงุช

| ุงูููุฒุฉ | ุงูุญุงูุฉ | ุงููุงุฆุฏุฉ |
|--------|--------|--------|
| Prompts ูุญุณููุฉ | โ | ุฎุทุฃ ุฃูู + ุงุชุณูุงู ุฃูุถู |
| Validation ููู | โ | ุถูุงู ุฌูุฏุฉ ุงูุฃุณุฆูุฉ |
| ุฅุนุฏุงุฏุงุช ูุฑูุฉ | โ | ุชุฎุตูุต ุญุณุจ ุงูุงุญุชูุงุฌุงุช |
| ูุธุงู ูุณุงุนุฏุงุช | โ | ูุณุงุนุฏุฉ ุงููุงุนุจูู ุงูุถุนูุงุก |
| ุฅุจูุงุบ ุงูุฃุณุฆูุฉ | โ | ุชุญุณูู ูุณุชูุฑ |

---

**ุขุฎุฑ ุชุญุฏูุซ**: ุงูููู  
**ุงูุฅุตุฏุงุฑ**: v2.1.0  
**ุญุงูุฉ ุงูุจูุงุก**: โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ
